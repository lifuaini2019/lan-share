<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½å±€åŸŸç½‘æ£€æµ‹æµ‹è¯•</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            margin: 0;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: rgba(255, 255, 255, 0.1); 
            border-radius: 12px; 
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        h1 { text-align: center; margin-bottom: 30px; }
        .test-section { 
            margin: 20px 0; 
            padding: 20px; 
            border: 1px solid rgba(255, 255, 255, 0.2); 
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
        }
        button { 
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 6px; 
            cursor: pointer; 
            margin: 5px;
            font-size: 16px;
            transition: all 0.3s ease;
        }
        button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        .result { 
            margin-top: 15px; 
            padding: 15px; 
            border-radius: 6px; 
            background: rgba(255, 255, 255, 0.1);
            white-space: pre-wrap;
            font-family: monospace;
        }
        .status { 
            padding: 10px; 
            border-radius: 6px; 
            margin: 10px 0;
            font-weight: bold;
        }
        .success { background: rgba(40, 167, 69, 0.3); }
        .error { background: rgba(220, 53, 69, 0.3); }
        .info { background: rgba(23, 162, 184, 0.3); }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” æ™ºèƒ½å±€åŸŸç½‘æ£€æµ‹åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="test-section">
            <h3>ğŸ“¡ å½“å‰è®¿é—®ä¿¡æ¯</h3>
            <div class="status info" id="currentInfo">
                æ­£åœ¨è·å–å½“å‰è®¿é—®ä¿¡æ¯...
            </div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ§ª APIæµ‹è¯•</h3>
            <button onclick="testLANDetectionAPI()">æµ‹è¯•å±€åŸŸç½‘æ£€æµ‹API</button>
            <button onclick="testDirectAccess()">æ¨¡æ‹Ÿç›´æ¥è°ƒç”¨æ£€æµ‹</button>
            <button onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
            <div id="apiTestResult" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ¯ æ¨¡æ‹Ÿæµ‹è¯•åœºæ™¯</h3>
            <button onclick="simulateDomainAccess()">æ¨¡æ‹ŸåŸŸåè®¿é—®</button>
            <button onclick="simulateIPAccess()">æ¨¡æ‹ŸIPè®¿é—®</button>
            <button onclick="simulateRemoteAccess()">æ¨¡æ‹Ÿè¿œç¨‹è®¿é—®</button>
            <div id="simulationResult" class="result" style="display: none;"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ­ æ™ºèƒ½æç¤ºæ¼”ç¤º</h3>
            <button onclick="showSamplePrompt()">æ˜¾ç¤ºåˆ‡æ¢æç¤ºç¤ºä¾‹</button>
            <button onclick="testActualDetection()">æ‰§è¡ŒçœŸå®æ£€æµ‹</button>
        </div>
    </div>

    <script>
        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå½“å‰è®¿é—®ä¿¡æ¯
        window.onload = function() {
            showCurrentAccessInfo();
        };
        
        // æ˜¾ç¤ºå½“å‰è®¿é—®ä¿¡æ¯
        function showCurrentAccessInfo() {
            const info = document.getElementById('currentInfo');
            info.innerHTML = `
                ğŸŒ å½“å‰åŸŸå: ${window.location.hostname}
                ğŸ“ å½“å‰ç«¯å£: ${window.location.port}
                ğŸ”— å®Œæ•´åœ°å€: ${window.location.href}
                ğŸ‘¤ ç”¨æˆ·ä»£ç†: ${navigator.userAgent.substring(0, 60)}...
                ğŸ“± å±å¹•å°ºå¯¸: ${screen.width}x${screen.height}
                ğŸ• å½“å‰æ—¶é—´: ${new Date().toLocaleString('zh-CN')}
            `;
        }
        
        // æµ‹è¯•å±€åŸŸç½‘æ£€æµ‹API
        function testLANDetectionAPI() {
            const resultDiv = document.getElementById('apiTestResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = 'ğŸ”„ æ­£åœ¨è°ƒç”¨API...';
            
            fetch('/api/lan-check')
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    resultDiv.innerHTML = `
âœ… APIè°ƒç”¨æˆåŠŸï¼

ğŸ“Š æ£€æµ‹ç»“æœï¼š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸŒ å½“å‰ä¸»æœº: ${data.current_host}
ğŸ“ å®¢æˆ·ç«¯IP: ${data.client_ip}
ğŸ  æœ¬æœºå±€åŸŸç½‘IP: ${data.local_ip}
ğŸ” æ˜¯å¦IPè®¿é—®: ${data.is_ip_access ? 'æ˜¯' : 'å¦'}
ğŸ“¶ å®¢æˆ·ç«¯åœ¨å±€åŸŸç½‘: ${data.is_client_in_lan ? 'æ˜¯' : 'å¦'}
ğŸ”” éœ€è¦æç¤ºåˆ‡æ¢: ${data.need_switch_prompt ? 'æ˜¯' : 'å¦'}
ğŸ”— å±€åŸŸç½‘åœ°å€: ${data.lan_url}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’¡ åˆ†æï¼š
${analyzeDetectionResult(data)}
                    `;
                })
                .catch(error => {
                    resultDiv.innerHTML = `
âŒ APIè°ƒç”¨å¤±è´¥ï¼

é”™è¯¯ä¿¡æ¯: ${error.message}
                    `;
                });
        }
        
        // åˆ†ææ£€æµ‹ç»“æœ
        function analyzeDetectionResult(data) {
            let analysis = '';
            
            if (data.need_switch_prompt) {
                analysis += 'ğŸ¯ ç¬¦åˆåˆ‡æ¢æ¡ä»¶ï¼šé€šè¿‡åŸŸåè®¿é—®ä½†åœ¨å±€åŸŸç½‘ç¯å¢ƒ\n';
                analysis += '   æ¨èæ“ä½œï¼šæ˜¾ç¤ºåˆ‡æ¢æç¤º\n';
            } else if (data.is_ip_access) {
                analysis += 'ğŸ’» ç›´æ¥IPè®¿é—®ï¼šç”¨æˆ·å·²åœ¨ä½¿ç”¨å±€åŸŸç½‘åœ°å€\n';
                analysis += '   æ— éœ€æ“ä½œï¼šå½“å‰è®¿é—®æ–¹å¼æœ€ä¼˜\n';
            } else if (!data.is_client_in_lan) {
                analysis += 'ğŸŒ è¿œç¨‹è®¿é—®ï¼šç”¨æˆ·ä¸åœ¨å±€åŸŸç½‘ç¯å¢ƒ\n';
                analysis += '   æ— éœ€æ“ä½œï¼šåªèƒ½ä½¿ç”¨åŸŸåè®¿é—®\n';
            } else {
                analysis += 'â“ ç‰¹æ®Šæƒ…å†µï¼šè¯·æ£€æŸ¥æ£€æµ‹é€»è¾‘\n';
            }
            
            return analysis;
        }
        
        // æµ‹è¯•ç›´æ¥è°ƒç”¨æ£€æµ‹
        function testDirectAccess() {
            // è¿™é‡Œæ¨¡æ‹Ÿç›´æ¥è°ƒç”¨æˆ‘ä»¬çš„æ™ºèƒ½æ£€æµ‹å‡½æ•°
            if (typeof performLANDetection === 'function') {
                const resultDiv = document.getElementById('apiTestResult');
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = 'ğŸ”„ æ­£åœ¨æ‰§è¡Œç›´æ¥æ£€æµ‹...';
                
                try {
                    performLANDetection();
                    resultDiv.innerHTML = 'âœ… ç›´æ¥æ£€æµ‹å·²è§¦å‘ï¼Œè¯·æŸ¥çœ‹æ§åˆ¶å°å’Œé¡µé¢ååº”';
                } catch (error) {
                    resultDiv.innerHTML = `âŒ ç›´æ¥æ£€æµ‹å¤±è´¥: ${error.message}`;
                }
            } else {
                const resultDiv = document.getElementById('apiTestResult');
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = 'âŒ æ£€æµ‹å‡½æ•°æœªæ‰¾åˆ°ï¼Œè¯·ç¡®ä¿åœ¨ä¸»é¡µé¢ä¸­è¿è¡Œæ­¤æµ‹è¯•';
            }
        }
        
        // æ¸…ç©ºç»“æœ
        function clearResults() {
            document.getElementById('apiTestResult').style.display = 'none';
            document.getElementById('simulationResult').style.display = 'none';
        }
        
        // æ¨¡æ‹ŸåŸŸåè®¿é—®
        function simulateDomainAccess() {
            const resultDiv = document.getElementById('simulationResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
ğŸŒ æ¨¡æ‹ŸåŸŸåè®¿é—®åœºæ™¯ï¼š

å‡è®¾ç”¨æˆ·é€šè¿‡ "example.com:9405" è®¿é—®
âœ… åŸŸåè®¿é—® (éIP)
âœ… å®¢æˆ·ç«¯åœ¨å±€åŸŸç½‘ (192.168.x.x)
ğŸ¯ ç»“æœï¼šåº”è¯¥æ˜¾ç¤ºåˆ‡æ¢æç¤º

è¿™æ˜¯æœ€å…¸å‹çš„éœ€è¦æ™ºèƒ½æç¤ºçš„åœºæ™¯ï¼
            `;
        }
        
        // æ¨¡æ‹ŸIPè®¿é—®
        function simulateIPAccess() {
            const resultDiv = document.getElementById('simulationResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
ğŸ’» æ¨¡æ‹ŸIPè®¿é—®åœºæ™¯ï¼š

å‡è®¾ç”¨æˆ·é€šè¿‡ "192.168.1.100:9405" è®¿é—®
âœ… IPè®¿é—® (ç›´æ¥ä½¿ç”¨IPåœ°å€)
âœ… å®¢æˆ·ç«¯åœ¨å±€åŸŸç½‘
âŒ ç»“æœï¼šä¸éœ€è¦æç¤ºåˆ‡æ¢

ç”¨æˆ·å·²ç»åœ¨ä½¿ç”¨æœ€ä¼˜çš„è®¿é—®æ–¹å¼ï¼
            `;
        }
        
        // æ¨¡æ‹Ÿè¿œç¨‹è®¿é—®
        function simulateRemoteAccess() {
            const resultDiv = document.getElementById('simulationResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
ğŸŒ æ¨¡æ‹Ÿè¿œç¨‹è®¿é—®åœºæ™¯ï¼š

å‡è®¾ç”¨æˆ·é€šè¿‡ "example.com:9405" è®¿é—®
âœ… åŸŸåè®¿é—® (éIP)
âŒ å®¢æˆ·ç«¯ä¸åœ¨å±€åŸŸç½‘ (å¤–ç½‘IP)
âŒ ç»“æœï¼šä¸éœ€è¦æç¤ºåˆ‡æ¢

ç”¨æˆ·åœ¨è¿œç¨‹ç¯å¢ƒï¼Œåªèƒ½ä½¿ç”¨åŸŸåè®¿é—®ï¼
            `;
        }
        
        // æ˜¾ç¤ºåˆ‡æ¢æç¤ºç¤ºä¾‹
        function showSamplePrompt() {
            // åˆ›å»ºä¸€ä¸ªç¤ºä¾‹æç¤º
            const sampleData = {
                current_host: 'example.com:9405',
                client_ip: '192.168.1.105',
                local_ip: '192.168.1.100',
                lan_url: 'http://192.168.1.100:9405'
            };
            
            if (typeof showLANSwitchPrompt === 'function') {
                showLANSwitchPrompt(sampleData);
            } else {
                alert('è¯·åœ¨ä¸»é¡µé¢ä¸­è¿è¡Œæ­¤æ¼”ç¤ºåŠŸèƒ½');
            }
        }
        
        // æ‰§è¡ŒçœŸå®æ£€æµ‹
        function testActualDetection() {
            if (typeof performLANDetection === 'function') {
                console.log('ğŸ§ª å¼€å§‹æ‰§è¡ŒçœŸå®çš„æ™ºèƒ½æ£€æµ‹...');
                performLANDetection();
            } else {
                alert('è¯·åœ¨ä¸»é¡µé¢ä¸­è¿è¡ŒçœŸå®æ£€æµ‹åŠŸèƒ½');
            }
        }
    </script>
</body>
</html>