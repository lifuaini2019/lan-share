<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å±€åŸŸç½‘æ£€æµ‹æ·±åº¦è°ƒè¯•å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            min-height: 100vh;
        }
        
        .debug-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .debug-btn {
            background: linear-gradient(45deg, #3498db, #2980b9);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            margin: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }
        
        .debug-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }
        
        .test-btn {
            background: linear-gradient(45deg, #27ae60, #219653);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            margin: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.4);
        }
        
        .log-area {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 20px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }
        
        .status-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        
        h1, h2 {
            margin-top: 0;
        }
        
        .clear-btn {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
        }
        
        .result-box {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            border-left: 4px solid #3498db;
        }
        
        .success-box {
            border-left: 4px solid #27ae60;
        }
        
        .error-box {
            border-left: 4px solid #e74c3c;
        }
        
        .warning-box {
            border-left: 4px solid #f39c12;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        th {
            background: rgba(255, 255, 255, 0.2);
            font-weight: 600;
        }
        
        tr:last-child td {
            border-bottom: none;
        }
        
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
        }
        
        .step {
            text-align: center;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            flex: 1;
            margin: 0 5px;
        }
        
        .step.active {
            background: rgba(52, 152, 219, 0.3);
            border: 2px solid #3498db;
        }
        
        .step.completed {
            background: rgba(39, 174, 96, 0.3);
            border: 2px solid #27ae60;
        }
    </style>
</head>
<body>
    <h1>ğŸ” å±€åŸŸç½‘æ£€æµ‹æ·±åº¦è°ƒè¯•å·¥å…· v1.0.8</h1>
    
    <div class="debug-card">
        <h2>ğŸ“ å½“å‰è®¿é—®ä¿¡æ¯</h2>
        <div class="status-info">
            <div><strong>ğŸŒ å½“å‰URL:</strong> <span id="currentURL">åŠ è½½ä¸­...</span></div>
            <div><strong>ğŸ  å½“å‰ä¸»æœº(Host):</strong> <span id="currentHost">åŠ è½½ä¸­...</span></div>
            <div><strong>ğŸ“Š åè®®:</strong> <span id="currentProtocol">åŠ è½½ä¸­...</span></div>
            <div><strong>ğŸšª ç«¯å£:</strong> <span id="currentPort">åŠ è½½ä¸­...</span></div>
        </div>
    </div>
    
    <div class="debug-card">
        <h2>ğŸ“‹ è°ƒè¯•æ­¥éª¤</h2>
        <div class="step-indicator">
            <div class="step active" id="step1">
                <div>1</div>
                <div>è®¿é—®æ–¹å¼æ£€æµ‹</div>
            </div>
            <div class="step" id="step2">
                <div>2</div>
                <div>APIè°ƒç”¨æµ‹è¯•</div>
            </div>
            <div class="step" id="step3">
                <div>3</div>
                <div>æ¡ä»¶åˆ†æ</div>
            </div>
            <div class="step" id="step4">
                <div>4</div>
                <div>æç¤ºæ˜¾ç¤º</div>
            </div>
        </div>
        
        <button class="debug-btn" onclick="step1_DetectAccessMethod()">ğŸ”¬ æ­¥éª¤1: æ£€æµ‹è®¿é—®æ–¹å¼</button>
        <button class="debug-btn" onclick="step2_TestAPICall()">ğŸ“¡ æ­¥éª¤2: æµ‹è¯•APIè°ƒç”¨</button>
        <button class="debug-btn" onclick="step3_AnalyzeConditions()">ğŸ“Š æ­¥éª¤3: åˆ†ææ˜¾ç¤ºæ¡ä»¶</button>
        <button class="test-btn" onclick="step4_TestPromptDisplay()">ğŸ”” æ­¥éª¤4: æµ‹è¯•æç¤ºæ˜¾ç¤º</button>
        <button class="clear-btn" onclick="clearLog()">ğŸ§¹ æ¸…ç©ºæ—¥å¿—</button>
    </div>
    
    <div class="debug-card">
        <h2>ğŸ“‹ è¯¦ç»†è°ƒè¯•æ—¥å¿—</h2>
        <div id="logArea" class="log-area">ç­‰å¾…æ‰§è¡Œè°ƒè¯•...\n</div>
    </div>
    
    <div class="debug-card">
        <h2>ğŸ“Š è°ƒè¯•ç»“æœåˆ†æ</h2>
        <div id="analysisResult" class="log-area">å°šæœªæ‰§è¡Œè°ƒè¯•...\n</div>
    </div>
    
    <div class="debug-card">
        <h2>ğŸ“‹ è¯¦ç»†è¯·æ±‚å¤´ä¿¡æ¯</h2>
        <table id="headersTable">
            <thead>
                <tr>
                    <th>è¯·æ±‚å¤´</th>
                    <th>å€¼</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td colspan="2">ç­‰å¾…æ‰§è¡Œè°ƒè¯•...</td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <div class="debug-card">
        <h2>ğŸ’¡ å¸¸è§é—®é¢˜æ’æŸ¥</h2>
        <div class="result-box">
            <h3>å¦‚æœä»ç„¶ä¸æ˜¾ç¤ºæç¤ºï¼Œè¯·æ£€æŸ¥ï¼š</h3>
            <ol>
                <li><strong>æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯</strong>ï¼šæŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ŒæŸ¥çœ‹Consoleæ˜¯å¦æœ‰JavaScripté”™è¯¯</li>
                <li><strong>ç½‘ç»œè¯·æ±‚</strong>ï¼šåœ¨Networkæ ‡ç­¾é¡µæŸ¥çœ‹/api/lan-checkè¯·æ±‚æ˜¯å¦æˆåŠŸ</li>
                <li><strong>CSSæ ·å¼é—®é¢˜</strong>ï¼šæ£€æŸ¥æç¤ºæ¡†å…ƒç´ æ˜¯å¦è¢«éšè—æˆ–æ ·å¼å¼‚å¸¸</li>
                <li><strong>DOMåŠ è½½æ—¶æœº</strong>ï¼šç¡®ä¿JavaScriptåœ¨DOMåŠ è½½å®Œæˆåæ‰§è¡Œ</li>
                <li><strong>æµè§ˆå™¨å…¼å®¹æ€§</strong>ï¼šå°è¯•ä½¿ç”¨ä¸åŒæµè§ˆå™¨æµ‹è¯•</li>
            </ol>
            
            <h3>æ‰‹åŠ¨æµ‹è¯•æ–¹æ³•ï¼š</h3>
            <p>åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œä»¥ä¸‹ä»£ç ï¼š</p>
            <pre><code>// 1. æµ‹è¯•APIè°ƒç”¨
fetch('/api/lan-check').then(r => r.json()).then(console.log)

// 2. å¼ºåˆ¶æ˜¾ç¤ºæç¤ºæ¡†
const mockData = {
    success: true,
    current_host: window.location.host,
    client_ip: '192.168.3.100',
    local_ip: '192.168.3.147',
    is_ip_access: false,
    is_client_in_lan: true,
    need_switch_prompt: true,
    lan_url: 'http://192.168.3.147:9405',
    user_agent: navigator.userAgent,
    referrer: ''
};
showLANSwitchPrompt(mockData);</code></pre>
        </div>
    </div>

    <script>
        // æ›´æ–°é¡µé¢ä¿¡æ¯
        function updatePageInfo() {
            document.getElementById('currentURL').textContent = window.location.href;
            document.getElementById('currentHost').textContent = window.location.host;
            document.getElementById('currentProtocol').textContent = window.location.protocol;
            document.getElementById('currentPort').textContent = window.location.port || 'é»˜è®¤ç«¯å£';
        }
        
        // æ·»åŠ æ—¥å¿—
        function addLog(message, type = 'info') {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            
            let typeClass = '';
            switch(type) {
                case 'success':
                    typeClass = 'âœ… ';
                    break;
                case 'error':
                    typeClass = 'âŒ ';
                    break;
                case 'warning':
                    typeClass = 'âš ï¸ ';
                    break;
                case 'info':
                    typeClass = 'â„¹ï¸ ';
                    break;
                default:
                    typeClass = 'ğŸ” ';
            }
            
            logArea.textContent += `[${timestamp}] ${typeClass}${message}\n`;
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        // æ›´æ–°æ­¥éª¤çŠ¶æ€
        function updateStepStatus(step, status) {
            const stepElement = document.getElementById(`step${step}`);
            stepElement.className = 'step';
            
            if (status === 'active') {
                stepElement.classList.add('active');
            } else if (status === 'completed') {
                stepElement.classList.add('completed');
            }
        }
        
        // æ¸…ç©ºæ—¥å¿—
        function clearLog() {
            document.getElementById('logArea').textContent = '';
            document.getElementById('analysisResult').textContent = 'ç­‰å¾…æ‰§è¡Œè°ƒè¯•...\n';
            document.querySelector('#headersTable tbody').innerHTML = '<tr><td colspan="2">ç­‰å¾…æ‰§è¡Œè°ƒè¯•...</td></tr>';
            
            // é‡ç½®æ­¥éª¤çŠ¶æ€
            for (let i = 1; i <= 4; i++) {
                updateStepStatus(i, i === 1 ? 'active' : '');
            }
        }
        
        // æ­¥éª¤1: æ£€æµ‹è®¿é—®æ–¹å¼
        function step1_DetectAccessMethod() {
            addLog('ğŸš€ å¼€å§‹æ‰§è¡Œæ­¥éª¤1: æ£€æµ‹è®¿é—®æ–¹å¼...', 'info');
            updateStepStatus(1, 'active');
            
            const currentHost = window.location.host;
            const hostname = currentHost.split(':')[0];
            const isIP = /^(\d{1,3}\.){3}\d{1,3}/.test(hostname);
            
            addLog(`ğŸŒ å½“å‰è®¿é—®åœ°å€: ${window.location.href}`, 'info');
            addLog(`ğŸ  å½“å‰ä¸»æœº: ${currentHost}`, 'info');
            addLog(`ğŸ” ä¸»æœºåéƒ¨åˆ†: ${hostname}`, 'info');
            addLog(`ğŸ“Š æ˜¯å¦ä¸ºIPåœ°å€: ${isIP}`, isIP ? 'warning' : 'success');
            
            if (isIP) {
                addLog('âŒ å½“å‰é€šè¿‡IPåœ°å€è®¿é—®ï¼Œä¸æ˜¯åŸŸåè®¿é—®ï¼Œä¸ä¼šè§¦å‘æ™ºèƒ½æ£€æµ‹', 'error');
            } else {
                addLog('âœ… å½“å‰é€šè¿‡åŸŸåè®¿é—®ï¼Œè¿™æ˜¯æ™ºèƒ½æ£€æµ‹çš„ç›®æ ‡åœºæ™¯', 'success');
            }
            
            // æ˜¾ç¤ºè¯·æ±‚å¤´ä¿¡æ¯
            displayRequestHeaders();
            
            updateStepStatus(1, 'completed');
            updateStepStatus(2, 'active');
            
            addLog('âœ… æ­¥éª¤1å®Œæˆï¼Œè¯·ç»§ç»­æ‰§è¡Œæ­¥éª¤2', 'success');
        }
        
        // æ˜¾ç¤ºè¯·æ±‚å¤´ä¿¡æ¯
        function displayRequestHeaders() {
            const headers = {
                'Host': window.location.host,
                'Origin': window.location.origin,
                'User-Agent': navigator.userAgent,
                'Platform': navigator.platform,
                'Language': navigator.language,
                'Online': navigator.onLine,
                'Cookies': document.cookie || 'æ— '
            };
            
            const tbody = document.querySelector('#headersTable tbody');
            tbody.innerHTML = '';
            
            for (const [key, value] of Object.entries(headers)) {
                const row = document.createElement('tr');
                row.innerHTML = `<td><strong>${key}</strong></td><td>${value}</td>`;
                tbody.appendChild(row);
            }
        }
        
        // æ­¥éª¤2: æµ‹è¯•APIè°ƒç”¨
        function step2_TestAPICall() {
            addLog('ğŸ“¡ å¼€å§‹æ‰§è¡Œæ­¥éª¤2: æµ‹è¯•APIè°ƒç”¨...', 'info');
            updateStepStatus(2, 'active');
            
            fetch('/api/lan-check')
                .then(response => {
                    addLog(`ğŸ“¡ APIå“åº”çŠ¶æ€: ${response.status}`, response.ok ? 'success' : 'error');
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    addLog('âœ… å±€åŸŸç½‘æ£€æµ‹APIè°ƒç”¨æˆåŠŸ', 'success');
                    addLog('ğŸ“Š APIè¿”å›æ•°æ®:', 'info');
                    addLog(JSON.stringify(data, null, 2), 'info');
                    
                    updateStepStatus(2, 'completed');
                    updateStepStatus(3, 'active');
                    
                    addLog('âœ… æ­¥éª¤2å®Œæˆï¼Œè¯·ç»§ç»­æ‰§è¡Œæ­¥éª¤3', 'success');
                })
                .catch(error => {
                    addLog(`âŒ å±€åŸŸç½‘æ£€æµ‹APIè°ƒç”¨å¤±è´¥: ${error.message}`, 'error');
                    addLog('ğŸ”§ å¯èƒ½çš„åŸå› :', 'warning');
                    addLog('   1. åç«¯æœåŠ¡æœªå¯åŠ¨', 'warning');
                    addLog('   2. ç½‘ç»œè¿æ¥é—®é¢˜', 'warning');
                    addLog('   3. APIè·¯å¾„é”™è¯¯', 'warning');
                    
                    updateStepStatus(2, 'completed');
                });
        }
        
        // æ­¥éª¤3: åˆ†ææ˜¾ç¤ºæ¡ä»¶
        function step3_AnalyzeConditions() {
            addLog('ğŸ“Š å¼€å§‹æ‰§è¡Œæ­¥éª¤3: åˆ†ææ˜¾ç¤ºæ¡ä»¶...', 'info');
            updateStepStatus(3, 'active');
            
            fetch('/api/lan-check')
                .then(response => response.json())
                .then(data => {
                    addLog('ğŸ” æ¡ä»¶åˆ†æ:', 'info');
                    addLog(`  - æ˜¯å¦IPè®¿é—®: ${data.is_ip_access}`, data.is_ip_access ? 'warning' : 'success');
                    addLog(`  - å®¢æˆ·ç«¯åœ¨å±€åŸŸç½‘: ${data.is_client_in_lan}`, data.is_client_in_lan ? 'success' : 'warning');
                    addLog(`  - éœ€è¦æç¤ºåˆ‡æ¢: ${data.need_switch_prompt}`, data.need_switch_prompt ? 'success' : 'warning');
                    
                    if (data.need_switch_prompt) {
                        addLog('âœ… æ»¡è¶³æ˜¾ç¤ºæç¤ºçš„æ‰€æœ‰æ¡ä»¶ï¼', 'success');
                        addLog(`ğŸ’¡ å±€åŸŸç½‘åœ°å€: ${data.lan_url}`, 'info');
                    } else {
                        addLog('âŒ ä¸æ»¡è¶³æ˜¾ç¤ºæç¤ºçš„æ¡ä»¶', 'error');
                        addLog('ğŸ”§ ä¸æ˜¾ç¤ºçš„åŸå› åˆ†æ:', 'warning');
                        
                        if (data.is_ip_access) {
                            addLog('   - é€šè¿‡IPåœ°å€è®¿é—®ï¼ˆåº”é€šè¿‡åŸŸåè®¿é—®ï¼‰', 'warning');
                        }
                        if (!data.is_client_in_lan) {
                            addLog('   - å®¢æˆ·ç«¯ä¸åœ¨å±€åŸŸç½‘ç¯å¢ƒ', 'warning');
                        }
                        if (!data.is_ip_access && data.is_client_in_lan && !data.need_switch_prompt) {
                            addLog('   - å±€åŸŸç½‘åœ°å€æµ‹è¯•å¤±è´¥', 'warning');
                            addLog(`   - å±€åŸŸç½‘åœ°å€: ${data.lan_url}`, 'warning');
                        }
                    }
                    
                    // æ˜¾ç¤ºè¯¦ç»†åˆ†æç»“æœ
                    showDetailedAnalysis(data);
                    
                    updateStepStatus(3, 'completed');
                    updateStepStatus(4, 'active');
                    
                    addLog('âœ… æ­¥éª¤3å®Œæˆï¼Œè¯·ç»§ç»­æ‰§è¡Œæ­¥éª¤4', 'success');
                })
                .catch(error => {
                    addLog(`âŒ è·å–æ£€æµ‹æ•°æ®å¤±è´¥: ${error.message}`, 'error');
                });
        }
        
        // æ˜¾ç¤ºè¯¦ç»†åˆ†æç»“æœ
        function showDetailedAnalysis(data) {
            let analysis = "ğŸ” è¯¦ç»†åˆ†æç»“æœ:\n\n";
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºåŸŸåè®¿é—®
            if (data.is_ip_access) {
                analysis += "âŒ é—®é¢˜1: å½“å‰æ˜¯é€šè¿‡IPåœ°å€è®¿é—®ï¼Œä¸æ˜¯åŸŸåè®¿é—®\n";
                analysis += "   è§£å†³æ–¹æ¡ˆ: è¯·é€šè¿‡åŸŸå http://2lan.lifu.eu.org è®¿é—®\n\n";
            } else {
                analysis += "âœ… æ£€æŸ¥1: å½“å‰æ˜¯é€šè¿‡åŸŸåè®¿é—®\n\n";
            }
            
            // æ£€æŸ¥å®¢æˆ·ç«¯æ˜¯å¦åœ¨å±€åŸŸç½‘
            if (!data.is_client_in_lan) {
                analysis += "âŒ é—®é¢˜2: å®¢æˆ·ç«¯ä¸åœ¨å±€åŸŸç½‘ç¯å¢ƒ\n";
                analysis += `   å½“å‰å®¢æˆ·ç«¯IP: ${data.client_ip}\n`;
                analysis += "   è§£å†³æ–¹æ¡ˆ: è¯·ç¡®ä¿åœ¨å±€åŸŸç½‘ç¯å¢ƒä¸­è®¿é—®\n\n";
            } else {
                analysis += "âœ… æ£€æŸ¥2: å®¢æˆ·ç«¯åœ¨å±€åŸŸç½‘ç¯å¢ƒ\n\n";
            }
            
            // æ£€æŸ¥æ˜¯å¦éœ€è¦æç¤º
            if (data.need_switch_prompt) {
                analysis += "âœ… æ£€æŸ¥3: æ»¡è¶³æ˜¾ç¤ºæç¤ºçš„æ‰€æœ‰æ¡ä»¶\n";
                analysis += "   åº”è¯¥æ˜¾ç¤ºæ™ºèƒ½åˆ‡æ¢æç¤ºï¼Œä½†æœªæ˜¾ç¤ºå¯èƒ½åŸå› :\n";
                analysis += "   - JavaScriptæ‰§è¡Œå¼‚å¸¸\n";
                analysis += "   - å‰ç«¯ä»£ç é—®é¢˜\n";
                analysis += "   - æµè§ˆå™¨å…¼å®¹æ€§é—®é¢˜\n";
                analysis += "   - CSSæ ·å¼é—®é¢˜\n\n";
            } else {
                analysis += "âŒ é—®é¢˜3: ä¸æ»¡è¶³æ˜¾ç¤ºæç¤ºçš„æ¡ä»¶\n";
                if (!data.is_ip_access && data.is_client_in_lan) {
                    analysis += "   å¯èƒ½æ˜¯å±€åŸŸç½‘åœ°å€æµ‹è¯•å¤±è´¥\n";
                    analysis += `   å±€åŸŸç½‘åœ°å€: ${data.lan_url}\n`;
                    analysis += `   æœ¬æœºIP: ${data.local_ip}\n\n`;
                }
            }
            
            // æ£€æŸ¥æœ¬æœºIPæ˜¯å¦æ­£ç¡®
            if (data.local_ip === "127.0.0.1" || data.local_ip === "::1") {
                analysis += "âš ï¸ è­¦å‘Š: æœ¬æœºIPä¸ºå›ç¯åœ°å€\n";
                analysis += "   è¿™å¯èƒ½å¯¼è‡´å±€åŸŸç½‘åœ°å€æµ‹è¯•å¤±è´¥\n\n";
            }
            
            analysis += "ğŸ“‹ å»ºè®®æ“ä½œ:\n";
            analysis += "1. æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰JavaScripté”™è¯¯\n";
            analysis += "2. ç¡®è®¤é€šè¿‡åŸŸå http://2lan.lifu.eu.org è®¿é—®\n";
            analysis += "3. ç¡®ä¿åœ¨å±€åŸŸç½‘ç¯å¢ƒä¸­è®¿é—®\n";
            analysis += "4. å¦‚æœä»æœ‰é—®é¢˜ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒ\n";
            
            document.getElementById('analysisResult').textContent = analysis;
        }
        
        // æ­¥éª¤4: æµ‹è¯•æç¤ºæ˜¾ç¤º
        function step4_TestPromptDisplay() {
            addLog('ğŸ”” å¼€å§‹æ‰§è¡Œæ­¥éª¤4: æµ‹è¯•æç¤ºæ˜¾ç¤º...', 'info');
            updateStepStatus(4, 'active');
            
            // é¦–å…ˆæ£€æŸ¥ç›¸å…³å‡½æ•°æ˜¯å¦å­˜åœ¨
            addLog('ğŸ” æ£€æŸ¥ç›¸å…³å‡½æ•°æ˜¯å¦å­˜åœ¨...', 'info');
            
            if (typeof showLANSwitchPrompt === 'function') {
                addLog('âœ… showLANSwitchPrompt å‡½æ•°å­˜åœ¨', 'success');
            } else {
                addLog('âŒ showLANSwitchPrompt å‡½æ•°ä¸å­˜åœ¨', 'error');
            }
            
            if (typeof createLANSwitchModal === 'function') {
                addLog('âœ… createLANSwitchModal å‡½æ•°å­˜åœ¨', 'success');
            } else {
                addLog('âŒ createLANSwitchModal å‡½æ•°ä¸å­˜åœ¨', 'error');
            }
            
            // æ¨¡æ‹ŸAPIè¿”å›æ•°æ®
            const mockData = {
                success: true,
                current_host: window.location.host,
                client_ip: '192.168.3.100',
                local_ip: '192.168.3.147',
                is_ip_access: false,
                is_client_in_lan: true,
                need_switch_prompt: true,
                lan_url: 'http://192.168.3.147:9405',
                user_agent: navigator.userAgent,
                referrer: ''
            };
            
            addLog('ğŸ”§ ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®æµ‹è¯•æç¤ºæ˜¾ç¤º...', 'info');
            
            try {
                // å°è¯•è°ƒç”¨æ˜¾ç¤ºå‡½æ•°
                if (typeof showLANSwitchPrompt === 'function') {
                    showLANSwitchPrompt(mockData);
                    addLog('âœ… æˆåŠŸè°ƒç”¨ showLANSwitchPrompt å‡½æ•°', 'success');
                } else if (typeof createLANSwitchModal === 'function') {
                    createLANSwitchModal(mockData);
                    addLog('âœ… æˆåŠŸè°ƒç”¨ createLANSwitchModal å‡½æ•°', 'success');
                } else {
                    addLog('âŒ æœªæ‰¾åˆ°æ˜¾ç¤ºæç¤ºçš„ç›¸å…³å‡½æ•°', 'error');
                    addLog('ğŸ’¡ è¯·ç¡®ä¿åœ¨ä¸»é¡µä¸­æµ‹è¯•æ­¤åŠŸèƒ½', 'warning');
                    return;
                }
                
                // æ£€æŸ¥æç¤ºæ¡†æ˜¯å¦åˆ›å»ºæˆåŠŸ
                setTimeout(() => {
                    const modal = document.getElementById('lanSwitchModal');
                    if (modal) {
                        addLog('âœ… æç¤ºæ¡†å·²æˆåŠŸåˆ›å»ºå¹¶æ·»åŠ åˆ°é¡µé¢', 'success');
                        addLog('ğŸ’¡ å¦‚æœæœªçœ‹åˆ°æç¤ºæ¡†ï¼Œè¯·æ£€æŸ¥CSSæ ·å¼æˆ–z-indexè®¾ç½®', 'warning');
                    } else {
                        addLog('âŒ æç¤ºæ¡†æœªåˆ›å»ºæˆåŠŸ', 'error');
                        addLog('ğŸ”§ å¯èƒ½çš„åŸå› :', 'warning');
                        addLog('   1. DOMå…ƒç´ æœªæ­£ç¡®æ·»åŠ ', 'warning');
                        addLog('   2. CSSæ ·å¼é—®é¢˜', 'warning');
                        addLog('   3. JavaScriptæ‰§è¡Œå¼‚å¸¸', 'warning');
                    }
                }, 100);
                
            } catch (error) {
                addLog(`âŒ è°ƒç”¨æ˜¾ç¤ºå‡½æ•°æ—¶å‘ç”Ÿé”™è¯¯: ${error.message}`, 'error');
            }
            
            updateStepStatus(4, 'completed');
            addLog('âœ… æ‰€æœ‰è°ƒè¯•æ­¥éª¤å®Œæˆï¼', 'success');
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            updatePageInfo();
            addLog('ğŸ“„ å±€åŸŸç½‘æ£€æµ‹æ·±åº¦è°ƒè¯•å·¥å…·åŠ è½½å®Œæˆ', 'success');
            addLog('ğŸ’¡ è¯·ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æŒ‰æ­¥éª¤æ‰§è¡Œè°ƒè¯•', 'info');
        });
    </script>
</body>
</html>