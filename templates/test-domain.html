<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸŸåè®¿é—®æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .test-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 30px;
            margin: 20px 0;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .test-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            margin: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
        }
        
        .test-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(40, 167, 69, 0.4);
        }
        
        .log-area {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 20px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 14px;
            line-height: 1.5;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
            margin: 20px 0;
        }
        
        .status-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
        }
        
        h1, h2 {
            margin-top: 0;
        }
        
        .clear-btn {
            background: linear-gradient(45deg, #dc3545, #c82333);
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin-left: 10px;
        }
        
        .result-box {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            border-left: 4px solid #28a745;
        }
        
        .error-box {
            border-left: 4px solid #dc3545;
        }
    </style>
</head>
<body>
    <h1>ğŸ” åŸŸåè®¿é—®æµ‹è¯•é¡µé¢ v1.0.15</h1>
    
    <div class="test-card">
        <h2>ğŸ“ å½“å‰è®¿é—®ä¿¡æ¯</h2>
        <div class="status-info">
            <div><strong>ğŸŒ å½“å‰URL:</strong> <span id="currentURL"></span></div>
            <div><strong>ğŸ  å½“å‰ä¸»æœº:</strong> <span id="currentHost"></span></div>
            <div><strong>ğŸ“Š åè®®:</strong> <span id="currentProtocol"></span></div>
            <div><strong>ğŸšª ç«¯å£:</strong> <span id="currentPort"></span></div>
        </div>
        
        <button class="test-btn" onclick="testDomainAccess()">ğŸ§ª æµ‹è¯•åŸŸåè®¿é—®</button>
        <button class="test-btn" onclick="testLanDetection()">ğŸ“¡ æµ‹è¯•å±€åŸŸç½‘æ£€æµ‹</button>
        <button class="test-btn" onclick="forceLanPrompt()">ğŸ”” å¼ºåˆ¶æ˜¾ç¤ºå±€åŸŸç½‘æç¤º</button>
        <button class="clear-btn" onclick="clearLog()">ğŸ§¹ æ¸…ç©ºæ—¥å¿—</button>
    </div>
    
    <div class="test-card">
        <h2>ğŸ“‹ æµ‹è¯•æ—¥å¿—</h2>
        <div id="logArea" class="log-area">ç­‰å¾…æ‰§è¡Œæµ‹è¯•...\n</div>
    </div>
    
    <div class="test-card">
        <h2>ğŸ’¡ ä½¿ç”¨è¯´æ˜</h2>
        <div class="result-box">
            <h3>åŸŸåè®¿é—®æµ‹è¯•</h3>
            <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•åŸŸåè®¿é—®æ—¶çš„æ™ºèƒ½æ£€æµ‹åŠŸèƒ½ã€‚</p>
            
            <h3>æµ‹è¯•æ­¥éª¤</h3>
            <ol>
                <li>é€šè¿‡åŸŸåè®¿é—®æ­¤é¡µé¢: http://2lan.lifu.eu.org/test-domain</li>
                <li>ç‚¹å‡»"æµ‹è¯•åŸŸåè®¿é—®"æŒ‰é’®</li>
                <li>ç‚¹å‡»"æµ‹è¯•å±€åŸŸç½‘æ£€æµ‹"æŒ‰é’®</li>
                <li>è§‚å¯Ÿæ˜¯å¦æ˜¾ç¤ºå±€åŸŸç½‘åˆ‡æ¢æç¤º</li>
            </ol>
            
            <h3>è°ƒè¯•æ–¹æ³•</h3>
            <ul>
                <li>æ‰“å¼€æµè§ˆå™¨æ§åˆ¶å°(F12)æŸ¥çœ‹è¯¦ç»†æ—¥å¿—</li>
                <li>æ£€æŸ¥Networkæ ‡ç­¾é¡µä¸­/api/lan-checkè¯·æ±‚çš„å“åº”</li>
                <li>ä½¿ç”¨"å¼ºåˆ¶æ˜¾ç¤ºå±€åŸŸç½‘æç¤º"æŒ‰é’®æµ‹è¯•æç¤ºæ¡†æ˜¾ç¤º</li>
            </ul>
            
            <h3>é¢„æœŸç»“æœ</h3>
            <p>é€šè¿‡åŸŸåè®¿é—®æ—¶åº”è¯¥æ˜¾ç¤ºå±€åŸŸç½‘åˆ‡æ¢æç¤ºï¼Œæç¤ºæ‚¨åˆ‡æ¢åˆ°å±€åŸŸç½‘åœ°å€ä»¥è·å¾—æ›´å¿«çš„è®¿é—®é€Ÿåº¦ã€‚</p>
        </div>
    </div>

    <script>
        // æ›´æ–°é¡µé¢ä¿¡æ¯
        function updatePageInfo() {
            document.getElementById('currentURL').textContent = window.location.href;
            document.getElementById('currentHost').textContent = window.location.host;
            document.getElementById('currentProtocol').textContent = window.location.protocol;
            document.getElementById('currentPort').textContent = window.location.port || 'é»˜è®¤ç«¯å£';
        }
        
        // æ·»åŠ æ—¥å¿—
        function addLog(message) {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            logArea.textContent += `[${timestamp}] ${message}\n`;
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        // æ¸…ç©ºæ—¥å¿—
        function clearLog() {
            document.getElementById('logArea').textContent = '';
        }
        
        // æµ‹è¯•åŸŸåè®¿é—®
        function testDomainAccess() {
            addLog('ğŸš€ å¼€å§‹æµ‹è¯•åŸŸåè®¿é—®...');
            addLog(`ğŸŒ å½“å‰è®¿é—®åœ°å€: ${window.location.href}`);
            addLog(`ğŸ  å½“å‰ä¸»æœº: ${window.location.host}`);
            
            const hostname = window.location.host.split(':')[0];
            const isIP = /^(\d{1,3}\.){3}\d{1,3}/.test(hostname);
            
            if (isIP) {
                addLog('âŒ å½“å‰é€šè¿‡IPåœ°å€è®¿é—®ï¼Œä¸æ˜¯åŸŸåè®¿é—®');
            } else {
                addLog('âœ… å½“å‰é€šè¿‡åŸŸåè®¿é—®');
                addLog('ğŸ’¡ è¿™æ˜¯æ™ºèƒ½æ£€æµ‹åŠŸèƒ½çš„ç›®æ ‡åœºæ™¯');
            }
        }
        
        // æµ‹è¯•å±€åŸŸç½‘æ£€æµ‹
        function testLanDetection() {
            addLog('ğŸ“¡ å¼€å§‹æµ‹è¯•å±€åŸŸç½‘æ£€æµ‹...');
            
            // è°ƒç”¨å±€åŸŸç½‘æ£€æµ‹API
            fetch('/api/lan-check')
                .then(response => {
                    addLog(`ğŸ“¡ APIå“åº”çŠ¶æ€: ${response.status}`);
                    if (!response.ok) {
                        throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    addLog('âœ… å±€åŸŸç½‘æ£€æµ‹APIè°ƒç”¨æˆåŠŸ');
                    addLog('ğŸ“Š æ£€æµ‹ç»“æœ:');
                    addLog(`  - å½“å‰ä¸»æœº: ${data.current_host}`);
                    addLog(`  - å®¢æˆ·ç«¯IP: ${data.client_ip}`);
                    addLog(`  - æ˜¯å¦IPè®¿é—®: ${data.is_ip_access}`);
                    addLog(`  - å®¢æˆ·ç«¯åœ¨å±€åŸŸç½‘: ${data.is_client_in_lan}`);
                    addLog(`  - éœ€è¦æç¤ºåˆ‡æ¢: ${data.need_switch_prompt}`);
                    addLog(`  - å±€åŸŸç½‘åœ°å€: ${data.lan_url}`);
                    
                    if (data.need_switch_prompt) {
                        addLog('ğŸ”” æ»¡è¶³æ˜¾ç¤ºæç¤ºæ¡ä»¶ï¼');
                        addLog('ğŸ’¡ åº”è¯¥æ˜¾ç¤ºå±€åŸŸç½‘åˆ‡æ¢æç¤º');
                    } else {
                        addLog('ğŸ” ä¸æ»¡è¶³æ˜¾ç¤ºæç¤ºæ¡ä»¶');
                        if (data.is_ip_access) {
                            addLog('   åŸå› : é€šè¿‡IPåœ°å€è®¿é—®');
                        }
                        if (!data.is_client_in_lan) {
                            addLog('   åŸå› : å®¢æˆ·ç«¯ä¸åœ¨å±€åŸŸç½‘');
                        }
                    }
                })
                .catch(error => {
                    addLog(`âŒ å±€åŸŸç½‘æ£€æµ‹APIè°ƒç”¨å¤±è´¥: ${error.message}`);
                });
        }
        
        // å¼ºåˆ¶æ˜¾ç¤ºå±€åŸŸç½‘æç¤º
        function forceLanPrompt() {
            addLog('ğŸ”” å¼ºåˆ¶æ˜¾ç¤ºå±€åŸŸç½‘æç¤º...');
            
            // æ¨¡æ‹ŸAPIè¿”å›æ•°æ®
            const mockData = {
                success: true,
                current_host: window.location.host,
                client_ip: '192.168.3.100',
                local_ip: '192.168.3.147',
                is_ip_access: false,
                is_client_in_lan: true,
                need_switch_prompt: true,
                lan_url: 'http://192.168.3.147:9405',
                user_agent: navigator.userAgent,
                referrer: ''
            };
            
            // å°è¯•è°ƒç”¨æ˜¾ç¤ºæç¤ºå‡½æ•°
            if (typeof showLANSwitchPrompt === 'function') {
                showLANSwitchPrompt(mockData);
                addLog('âœ… æˆåŠŸè°ƒç”¨showLANSwitchPromptå‡½æ•°');
            } else if (typeof createLANSwitchModal === 'function') {
                createLANSwitchModal(mockData);
                addLog('âœ… æˆåŠŸè°ƒç”¨createLANSwitchModalå‡½æ•°');
            } else {
                addLog('âŒ æœªæ‰¾åˆ°æ˜¾ç¤ºæç¤ºçš„å‡½æ•°');
                addLog('ğŸ’¡ è¯·ç¡®ä¿åœ¨ä¸»é¡µä¸­æµ‹è¯•æ­¤åŠŸèƒ½');
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
        document.addEventListener('DOMContentLoaded', function() {
            updatePageInfo();
            addLog('ğŸ“„ åŸŸåè®¿é—®æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            addLog('ğŸ’¡ è¯·ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è¿›è¡Œæµ‹è¯•');
        });
    </script>
</body>
</html>