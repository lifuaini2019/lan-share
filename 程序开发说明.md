# 祖宇字文共享系统 - 程序开发说明

## 1. 项目概述

祖宇字文共享系统是一个专为局域网环境设计的文字共享工具，支持多设备间实时同步文字内容。该系统采用Go语言开发，使用Gin框架作为Web服务器，支持WebSocket实时通信，具有响应式设计，适配手机端和电脑端访问。

### 1.1 核心功能
- 实时文字共享：支持多设备间实时同步文字内容
- 模板管理：预设常用回复模板，快速复制使用
- 文件传输：支持局域网内文件快速传输
- 二维码分享：自动生成访问二维码，扫码即用
- 数据导入导出：支持模板数据的备份与恢复
- 响应式设计：支持电脑端和手机端访问
- 实时同步：基于WebSocket技术实现实时通信
- 智能局域网检测：自动识别局域网环境并提示切换

## 2. 技术架构

### 2.1 后端技术栈
- **语言**: Go 1.25.0
- **Web框架**: Gin v1.10.1
- **实时通信**: Gorilla WebSocket v1.5.3
- **二维码生成**: go-qrcode v0.0.0
- **跨域支持**: gin-contrib/cors v1.7.6

### 2.2 前端技术栈
- **HTML5/CSS3**: 响应式设计
- **JavaScript**: 原生JavaScript实现功能
- **WebSocket**: 实现实时通信

### 2.3 项目结构
```
LAN-to-go/
├── main.go                 # 主程序入口
├── go.mod                  # Go模块定义
├── go.sum                  # Go依赖校验
├── 1.sh                    # 玩客云一键部署脚本
├── templates_config.json   # 模板配置文件
├── static/                 # 静态资源目录
│   └── style.css           # 样式文件
├── templates/              # HTML模板目录
│   ├── index.html          # 主页面
│   ├── debug_lan_detection.html  # 局域网检测调试页面
│   ├── enhanced_debug.html       # 增强调试页面
│   ├── smart-detection-help.html # 智能检测帮助页面
│   ├── test-domain.html          # 域名测试页面
│   ├── test_all_domains.html     # 全域名测试页面
│   └── debug_lan_detection.html  # 局域网检测深度调试页面
```

## 3. 功能详解

### 3.1 实时文字共享功能

#### 3.1.1 电脑端功能
- **文字输入区域**: 提供大文本框用于输入内容
- **快速提交**: 按Enter键快速提交内容
- **实时同步**: 通过WebSocket实现多设备实时同步
- **消息管理**: 支持删除、复制消息
- **模板添加**: 可将消息添加到预设模板栏目

#### 3.1.2 手机端功能
- **响应式布局**: 适配手机屏幕尺寸
- **触摸优化**: 按钮和操作区域适合手指点击
- **简化界面**: 精简功能布局，突出核心操作
- **实时同步**: 与电脑端保持数据同步

### 3.2 模板管理系统

#### 3.2.1 预设栏目
1. **共享文字** (🏠): 默认文字共享界面
2. **售前咨询** (💬): 客服售前问题模板
3. **快递问题** (📦): 物流相关问题模板
4. **售后服务** (🛠️): 售后服务问题模板
5. **购买链接** (🛒): 商品购买链接模板
6. **维修服务** (🔧): 设备维修问题模板
7. **系统设置** (⚙️): 系统配置和数据管理

#### 3.2.2 模板操作功能
- **模板浏览**: 按栏目分类浏览模板
- **内容复制**: 一键复制模板内容到剪贴板
- **模板添加**: 添加新的模板到指定栏目
- **模板编辑**: 编辑现有模板内容
- **模板删除**: 删除不需要的模板
- **栏目清空**: 批量删除栏目内所有模板

### 3.3 文件传输功能

#### 3.3.1 发送文件
- **文件选择**: 支持拖拽和点击选择文件
- **多文件支持**: 可同时选择多个文件发送
- **格式限制**: 支持文档、图片、压缩文件等
- **大小限制**: 单文件最大16MB

#### 3.3.2 接收文件
- **实时通知**: 收到文件时显示通知
- **传输模式**: 
  - 独占模式: 一人接收后其他人自动取消
  - 共享模式: 所有人都能同时接收
- **文件下载**: 点击接收按钮下载文件

### 3.4 智能局域网检测

#### 3.4.1 检测机制
- **访问方式识别**: 区分域名访问和IP访问
- **网络环境判断**: 识别客户端是否在局域网
- **智能提示**: 满足条件时自动显示切换提示

#### 3.4.2 显示条件
- 通过域名访问
- 客户端在局域网环境中
- 局域网地址可访问

### 3.5 系统设置功能

#### 3.5.1 添加内容
- **栏目选择**: 选择目标模板栏目
- **标题设置**: 设置模板标题
- **内容编辑**: 编辑模板内容
- **快速添加**: 一键添加新模板

#### 3.5.2 管理内容
- **栏目浏览**: 查看各栏目模板列表
- **批量操作**: 批量管理模板内容
- **栏目清空**: 删除指定栏目所有模板
- **全部清空**: 删除所有栏目模板

#### 3.5.3 数据导入导出
- **导出格式**: 支持TXT和JSON格式
- **导出范围**: 可选择全部或指定栏目
- **导入模式**: 支持合并和替换模式
- **导入范围**: 可选择全部或指定栏目

## 4. 界面布局设计

### 4.1 电脑端布局

#### 4.1.1 主界面布局
- **左侧边栏**: 固定显示栏目菜单
- **顶部区域**: 标题、连接状态、网络类型
- **中部区域**: 文字输入和提交区域
- **消息列表**: 显示已保存的内容
- **底部区域**: 二维码展示区域

#### 4.1.2 模板界面布局
- **左侧边栏**: 栏目选择菜单
- **顶部区域**: 栏目标题
- **内容区域**: 模板卡片网格布局
- **操作按钮**: 复制按钮位于卡片右上角

#### 4.1.3 设置界面布局
- **左侧边栏**: 栏目选择菜单
- **顶部区域**: 系统设置标题
- **功能区域**: 分为添加内容、管理内容、数据管理三个部分
- **表单设计**: 清晰的表单布局和操作按钮

### 4.2 手机端布局

#### 4.2.1 主界面布局
- **顶部按钮**: 菜单按钮位于左上角
- **顶部区域**: 标题、连接状态、网络类型
- **中部区域**: 文字输入和提交区域
- **消息列表**: 垂直排列的消息卡片
- **底部区域**: 二维码展示区域

#### 4.2.2 菜单设计
- **滑动菜单**: 从左侧滑出的栏目菜单
- **菜单按钮**: 点击显示/隐藏菜单
- **栏目列表**: 垂直排列的栏目选项

#### 4.2.3 操作优化
- **按钮放大**: 适合手指点击的按钮尺寸
- **标签化设计**: 消息操作按钮采用标签样式
- **垂直排列**: 重要信息垂直排列，便于阅读

## 5. 响应式设计

### 5.1 断点设计
- **手机端**: 最大宽度768px
- **平板端**: 769px-1024px
- **桌面端**: 最小宽度1025px

### 5.2 适配策略
- **弹性布局**: 使用Flexbox和Grid布局
- **媒体查询**: 针对不同设备使用不同样式
- **字体适配**: 根据屏幕尺寸调整字体大小
- **间距优化**: 不同设备使用合适的间距

## 6. 部署与运维

### 6.1 玩客云部署
- **一键部署脚本**: [1.sh](file:///Users/libao/%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/%E5%BC%80%E5%8F%91%E7%9A%84%E5%B1%80%E5%9F%9F%E7%BD%91%E5%B7%A5%E5%85%B7/LAN-to-go/1.sh)
- **交叉编译**: ARM架构编译
- **自动上传**: 通过SSH上传到玩客云
- **服务启动**: 后台运行程序

### 6.2 访问地址
- **局域网访问**: http://[玩客云IP]:9405
- **域名访问**: http://2lan.lifu.eu.org

### 6.3 系统管理
- **日志查看**: tail -f /root/lan-to-go/lan-to-go.log
- **服务停止**: pkill -f zuyu-share-openwrt-armv7
- **服务重启**: cd /root/lan-to-go && setsid ./zuyu-share-openwrt-armv7 > lan-to-go.log 2>&1 &

## 7. 调试与测试

### 7.1 调试页面
- **局域网检测调试**: /debug-lan-detection
- **增强调试**: /advanced-debug
- **域名测试**: /test-domain
- **全域名测试**: /test_all_domains
- **智能检测帮助**: /smart-detection-help

### 7.2 测试方法
- **强制提示**: 添加?force_prompt=true参数
- **API测试**: 访问/api/lan-check接口
- **控制台调试**: 浏览器开发者工具

## 8. 安全与权限

### 8.1 访问安全
- **局域网限制**: 仅在局域网内可访问
- **端口保护**: 9405端口限制访问
- **域名绑定**: 支持自定义域名访问

### 8.2 数据安全
- **文件传输**: 局域网内传输，不经过公网
- **数据存储**: 本地存储，不上传到云端
- **权限控制**: 无用户权限系统，适合局域网使用

## 9. 性能优化

### 9.1 前端优化
- **资源压缩**: CSS和HTML优化
- **懒加载**: 按需加载内容
- **缓存策略**: 合理使用浏览器缓存

### 9.2 后端优化
- **连接复用**: WebSocket长连接
- **内存管理**: 及时释放资源
- **并发处理**: 支持多设备同时访问

## 10. 版本信息

### 10.1 当前版本
- **版本号**: v1.0.15
- **发布日期**: 2025年
- **更新内容**: 智能局域网检测功能增强

### 10.2 版本管理
- **版本控制**: Git管理源代码
- **部署脚本**: [v.sh](file:///Users/libao/%E7%A8%8B%E5%BA%8F%E5%BC%80%E5%8F%91/%E5%BC%80%E5%8F%91%E7%9A%84%E5%B1%80%E5%9F%9F%E7%BD%91%E5%B7%A5%E5%85%B7/LAN-to-go/v.sh)一键部署
- **回退机制**: 支持回退到上一版本

## 11. 扩展功能

### 11.1 可扩展性
- **模块化设计**: 功能模块独立，易于扩展
- **API接口**: 提供RESTful API接口
- **插件机制**: 支持功能插件扩展

### 11.2 未来规划
- **用户系统**: 添加用户权限管理
- **数据统计**: 增加使用数据统计功能
- **移动端APP**: 开发原生移动端应用
- **云同步**: 支持云端数据备份

---
*文档版本: v1.0*
*最后更新: 2025年9月10日*